<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>D30 Printer PWA</title>

<!-- Tailwind CDN (we can switch to compiled later) -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  body { background: white; color: #111; font-family: Inter, sans-serif; }
  .tab { padding: 8px 12px; cursor: pointer; border-bottom: 2px solid transparent; }
  .tab.active { border-color: #2563eb; color: #2563eb; }
  .tab-content { display: none; }
  .btn { background:#2563eb; color:white; padding:6px 12px; border-radius:6px; }
  .btn:active { opacity:0.7; }
  .small { font-size: 12px; color:#555; }
  .preview-canvas { border: 1px solid #aaa; border-radius:6px; }
  #previewBox { display:flex; justify-content:center; }
  #previewCanvasWrap { display:flex; justify-content:center; align-items:center; width:100%; }
  .floating-print {
    position: fixed; bottom: 18px; right: 18px;
    background:#2563eb; color:white;
    padding:14px 20px; border-radius:12px;
    font-size:18px;
    box-shadow:0 3px 10px rgba(0,0,0,0.25);
  }
  .floating-print:active { opacity:0.7; }
  label.inline { display:flex; align-items:center; gap:6px; }
</style>
</head>

<body class="p-4">
<header class="flex justify-between items-center mb-3">
  <h1 class="text-xl font-semibold">D30 Printer</h1>
  <button id="connectBtn" class="btn">Connect</button>
</header>
<div class="text-sm mb-2">Status: <span id="connectionStatus">Not connected</span></div>

<!-- üîπ PREVIEW (shared across all tabs) -->
<div id="previewRoot" class="mb-4">
  <div id="previewBox">
    <div id="previewCanvasWrap">
      <!-- Preview gets injected here -->
    </div>
  </div>
  <div id="previewHint" class="text-xs text-gray-500 mt-1 px-2">
    Preview shown in label proportions. Change label size in Settings.
  </div>
</div>

<!-- üîπ TABS -->
<div id="tabBar" class="flex border-b mb-3">
  <div class="tab active" data-tab="tab-text">Text</div>
  <div class="tab" data-tab="tab-image">Image</div>
  <div class="tab" data-tab="tab-barcode">Barcode</div>
  <div class="tab" data-tab="tab-qr">QR</div>
  <div class="tab" data-tab="tab-settings">Settings</div>
  <div class="tab" data-tab="tab-logs">Logs</div>
</div>

<!-- üîπ TAB: TEXT -->
<div id="tab-text" class="tab-content" style="display:block;">
  <textarea id="textInput" class="w-full border p-2 rounded" rows="3" placeholder="Enter text"></textarea>

  <div class="flex flex-wrap gap-4 mt-2">
    <div>
      <label class="small">Font size</label>
      <input id="fontSize" type="number" min="8" max="200" value="36" class="border p-1 w-20">
    </div>

    <div>
      <label class="small">Preset</label>
      <select id="fontPreset" class="border p-1">
        <option value="24">24</option>
        <option value="36" selected>36</option>
        <option value="48">48</option>
        <option value="60">60</option>
        <option value="80">80</option>
      </select>
    </div>

    <div class="flex items-end gap-1">
      <button id="fontDec" class="btn" style="padding:4px 8px;">-</button>
      <button id="fontInc" class="btn" style="padding:4px 8px;">+</button>
    </div>
  </div>

  <div class="flex flex-wrap gap-4 mt-2">
    <div>
      <label class="small">Alignment</label>
      <select id="alignment" class="border p-1" style="width:110px;">
        <option value="center" selected>Center</option>
        <option value="left">Left</option>
        <option value="right">Right</option>
      </select>
    </div>

    <div>
      <label class="small">Copies</label>
      <input id="copiesInput" type="number" value="1" min="1" class="border p-1 w-16">
    </div>

    <label class="inline small mt-5">
      <input id="invertInput" type="checkbox"> Invert
    </label>

    <label class="inline small mt-5">
      <input id="fontBold" type="checkbox"> Bold
    </label>
  </div>
</div>

<!-- üîπ TAB: IMAGE -->
<div id="tab-image" class="tab-content">
  <input id="imageFile" type="file" accept="image/*" class="mb-2" />
  <div id="imagePreview" style="margin-top:6px;"></div>

  <div class="flex flex-wrap gap-4 mt-2">
    <div>
      <label class="small">Threshold</label>
      <input id="imageThreshold" type="number" value="128" min="0" max="255" class="border p-1 w-20">
    </div>

    <div>
      <label class="small">Scale image (%)</label>
      <input id="imageScale" type="range" min="10" max="200" value="100" style="width:160px;">
      <div class="small" id="imageScaleLabel">100%</div>
    </div>

    <label class="inline small mt-5">
      <input id="imageInvert" type="checkbox"> Invert
    </label>
  </div>
</div>

<!-- üîπ TAB: BARCODE -->
<div id="tab-barcode" class="tab-content">
  <input id="barcodeInput" class="w-full border p-2 rounded" placeholder="Barcode content">
  
  <div class="flex flex-wrap gap-4 mt-2">
    <div>
      <label class="small">Type</label>
      <select id="barcodeType" class="border p-1">
        <option value="CODE128">Code 128 (recommended)</option>
        <option value="EAN13">EAN-13</option>
        <option value="EAN8">EAN-8</option>
        <option value="UPC">UPC</option>
      </select>
    </div>

    <div>
      <label class="small">Scale</label>
      <input id="barcodeScale" type="number" value="2" min="1" max="6" class="border p-1 w-16">
    </div>
  </div>
</div>

<!-- üîπ TAB: QR -->
<div id="tab-qr" class="tab-content">
  <input id="qrInput" class="w-full border p-2 rounded" placeholder="QR content">
  
  <div class="flex flex-wrap gap-4 mt-2">
    <div>
      <label class="small">Error Correction</label>
      <select id="qrEc" class="border p-1">
        <option value="M">M</option>
        <option value="L">L</option>
        <option value="Q">Q</option>
        <option value="H">H</option>
      </select>
    </div>

    <div>
      <label class="small">Size (px)</label>
      <input id="qrSize" type="number" value="256" min="64" max="800" class="border p-1 w-20">
    </div>
  </div>
</div>

<!-- üîπ TAB: SETTINGS -->
<div id="tab-settings" class="tab-content">
  <div class="flex flex-wrap gap-4 mt-2">
    <div>
      <label class="small">Label width (mm)</label>
      <input id="labelWidth" type="number" value="12" class="border p-1 w-20">
    </div>

    <div>
      <label class="small">Label length (mm)</label>
      <input id="labelLength" type="number" value="40" class="border p-1 w-20">
    </div>
  </div>

  <div class="mt-2">
    <button id="detectLabelBtn" class="btn">Detect</button>
    <div class="small mt-1">Auto detect is not yet implemented for this model.</div>
  </div>

  <div class="mt-3">
    <label class="small">Font family</label>
    <select id="fontFamily" class="border p-1">
      <option value="Inter, sans-serif">Inter</option>
      <option value="Arial, sans-serif">Arial</option>
      <option value="monospace">Monospace</option>
    </select>

    <label class="inline small" style="margin-left:14px;">
      <input id="forceInvert" type="checkbox"> Force bitmap invert
    </label>
  </div>

  <div class="mt-3">
    <label class="small">Protocol</label>
    <select id="protocolSelect" class="border p-1">
      <option value="escpos">ESC/POS</option>
      <option value="phomemo_raw" selected>Phomemo Raw</option>
    </select>
    <div class="small mt-1">More protocols may be added later.</div>
  </div>
</div>

<!-- üîπ TAB: LOGS -->
<div id="tab-logs" class="tab-content">
  <textarea id="logArea" class="w-full border p-2 rounded" style="height:200px;"></textarea>
</div>

<!-- Floating print button -->
<button id="fab-print" class="floating-print">üñ®Ô∏è Print</button>

<script type="module" src="./ui.js"></script>
<script>
  // Basic PWA service worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js').catch(console.error);
  }
</script>

</body>
</html>
